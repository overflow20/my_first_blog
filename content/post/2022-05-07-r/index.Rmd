---
title: "Ræ¯æ—¥éšå¿ƒè®°"
author: "zyy"
date: '2022-05-07'
slug: r
categories: []
tags: []
---

è¿™ä¸‰ç§è¯­è¨€è¯´ç†Ÿæ‚‰ä¹Ÿç†Ÿæ‚‰ï¼Œä½†æ€»è§‰å¾—ç¼ºä¹ä¸€ç§ç³»ç»Ÿæ„Ÿï¼Œé‚£å°±æ¯å¤©èŠ±ç‚¹æ—¶é—´æµè§ˆä¸€äº›ä¹¦ç±è®°å½•ä¸€ä¸‹å§ï¼

ä¹¦ç±åˆ—è¡¨(æ›´æ–°ä¸­)ï¼š

-   Rè¯­è¨€å®æˆ˜(ç¬¬2ç‰ˆ)
-   [ç°ä»£ç»Ÿè®¡å›¾å½¢](https://bookdown.org/xiangyun/msg/)

```{r setup, include=T}
knitr::opts_chunk$set(echo = T,collapse = T,
                      results = "hide")
```

## 5.31
```{r}
example(persp)
```
```{r}
par(mar = c(4, 4, 0.2, 0.2))
sunflowerplot(iris[, 3:4], col = "gold", seg.col = "gold")
```
```{r}
demo("symbols_all", echo = FALSE, package = "MSG")
```

## 5.29
äººä¸–å‡ å›ä¼¤å¾€äº‹ï¼Œå±±å½¢ä¾æ—§æ•å¯’æµã€‚å”‰
```{r}
demo("volcano", package = "MSG")
```
- å››ç“£å›¾
å››ç“£å›¾æœ€ç»ˆçš„è¯»æ³•å°±æ˜¯è§‚å¯Ÿä¸¤ç“£ç›¸é‚»æ‰‡å½¢çš„ç½®ä¿¡åŒºé—´å¼§çº¿æ˜¯å¦æœ‰é‡å ï¼Œæœ‰åˆ™è¯´æ˜ä¸èƒ½æ‹’ç»é›¶å‡è®¾ï¼Œåä¹‹å¯ä»¥æ‹’ç»
```{r}
ftable(UCBAdmissions) # ä»¥ç´§å‡‘å½¢å¼å±•ç°å‡ºæ¥çš„ UCB å½•å–æ•°æ®
fourfoldplot(UCBAdmissions, mfcol = c(2, 3)) # 2 è¡Œ 3 åˆ—æ’ç‰ˆ
```
- é¢œè‰²å›¾
```{r}
par(mar = rep(0, 4))
x <- matrix(sample(24), 8)
image(1:8, 1:3, x, col = heat.colors(24), axes = FALSE, ann = FALSE)
text(rep(1:8, 3), rep(1:3, each = 8), as.vector(x))
```

- çŸ©é˜µå›¾
```{r}
sines <- outer(1:20, 1:4, function(x, y) sin(x / 20 * pi * y))
par(mar = c(2, 4, .1, .1))
matplot(sines, type = "b", pch = 21:24, col = 2:5, bg = 2:5)

```
- é©¬èµ›å…‹å›¾
```{r}
ftable(Titanic)
par(mar = c(2, 3.5, .1, .1))
mosaicplot(Titanic, shade = TRUE, main = "")
```

## 5.28
- ç­‰é«˜çº¿
- æ¡ä»¶åˆ†å¸ƒ
- ä¸€å…ƒå‡½æ•°æ›²çº¿
```{r}
par(par(mar = c(4.5, 4, 0.2, 0.2)), mfrow = c(2, 1))
chippy <- function(x) sin(cos(x) * exp(-x / 2))
curve(chippy, -8, 7, n = 2008, xlab = "$x$", ylab = "$\\mathrm{chippy}(x)$")
curve(sin(x) / x, from = -20, to = 20, n = 200, 
      xlab = "$t$", ylab = "$\\varphi_{X}(t)$")

```

## 5.27
ä»¥åä»¥æ—¥æœŸä¸ºå‡†ï¼Œä¸ä»¥ä»Šå¤©ã€æ˜å¤©è¿™æ ·å«ç³Šçš„è¯è¯­
```{r}
(x <- margin.table(HairEyeColor, c(1, 2)))
assocplot(x)
```


## 5.26
- ç®±çº¿å›¾ï¼ˆboxplotï¼‰

- æ¡å½¢å›¾
```{r}
library(RColorBrewer) # ç”¨åˆ†ç±»è°ƒè‰²æ¿
par(mfrow = c(2, 1), mar = c(3, 2.5, 0.5, 0.1))
death <- t(VADeaths)[, 5:1]
barplot(death, col = brewer.pal(4, "Set1"))
barplot(death,
  col = brewer.pal(4, "Set1"), beside = TRUE,
  legend.text = TRUE
)
```
- æ•£ç‚¹å›¾
```{r}
demo("alphaDemo", package = "MSG")
```

## 5.25
- bootstrapæ–¹æ³•
```{r}
x=c(18.2,9.5,12.0,21.1,10.2)
theta<-median(x)
bootstrap<-function(x,B=10000){
        set.seed(123)
        G<-matrix(0,B,length(x))
        for(i in 1:B){
                G[i,]<-t(matrix(sample(x,length(x),replace = T)))
        }
        return(G)
}
#è¿è¡Œæ—¶é—´
tic<-proc.time()
b<-matrix(apply(bootstrap(x),1,median),1)
toc<-proc.time()
print(toc-tic)
#è¯¯å·®è®¡ç®—
(sd<-sqrt(((b)-mean(b))%*%(t(b)-mean(b))/(length(b)-1)))
(mean(b))
```
- èŒå¶å›¾ï¼ˆStem-and-Leaf Plotï¼‰
```{r}
head(islands, 10)#è¯¥æ•°æ®è®°å½•äº†ä¸–ç•Œä¸Šå„å¤§é™†åœ°å—çš„é¢ç§¯å¤§å°ï¼ŒåŸå§‹æ•°æ®å‰ 10 æ¡å¦‚ä¸‹ï¼ˆå•ä½ï¼šåƒå¹³æ–¹è‹±é‡Œï¼‰
stem(islands)
# å‡å€¼ lambda ä¸º 10 çš„æ³Šæ¾åˆ†å¸ƒéšæœºæ•°
sort(x <- rpois(80, lambda = 10))
stem(x, scale = 2)
```


## 5.23
peer pressure

- ç›´æ–¹å›¾ï¼ˆHistogramï¼‰
```{r}
par(mfrow = c(2, 2), mar = c(2, 3, 2, .5), mgp = c(2, .5, 0))
data(geyser, package = "MASS")
hist(geyser$waiting, main = "(1) freq = TRUE", xlab = "waiting")
hist(geyser$waiting, freq = FALSE, xlab = "waiting", main = "(2) freq = FALSE")
hist(geyser$waiting, breaks = 5, density = 10, xlab = "waiting", main = "(3) breaks = 5")
hist(geyser$waiting, breaks = 40, col = "red", xlab = "waiting", main = "(4) breaks = 40")

library(ggplot2)
library(cowplot)
p <- ggplot(aes(waiting), data = geyser)
p1 <- p + geom_histogram(breaks = seq(40, 110, by = 5))
p2 <- p + geom_histogram(breaks = seq(40, 110, by = 5), aes(y = ..density..))
p3 <- p + geom_histogram(breaks = seq(40, 110, by = 10))
p4 <- p + geom_histogram(breaks = seq(42, 108, by = 2), fill = "red", color = "black")
plot_grid(p1, p2, p3, p4, labels = c(
  "(1) freq = TRUE",
  "(2) freq = FALSE",
  "(3) breaks = 5",
  "(4) breaks = 40"
), ncol = 2)
```

```{r}
demo("hist_geyser", package = "MSG")
df <- data.frame(
  x = seq(40, 110, 5), y = 0,
  xend = seq(40, 110, 5), yend = ht
)
p2 + geom_density(fill = "lightgray", color = "black") +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend),
    data = df, lty = 3
  )

```

## 5.21
- ç€‘å¸ƒå›¾
```{r}
# ä¸ƒå¤©ä¹‹å†…çš„å”¯ä¸€è®¿é—®æ¬¡æ•°æ•°æ®ï¼ˆå‘¨ä¸€ä¸º 2010 å¹´ 8 æœˆ 2 æ—¥ï¼‰
auv <- c(939, 1005, 973, 910, 875, 658, 688)
# ç›¸é‚»ä¸¤å¤©ä½œå·®
diff(auv)
par(mar = c(4, 4, .5, .1))
plot(auv,
  xlab = "å…«æœˆç¬¬ä¸€å‘¨",
  ylab = "ç»å¯¹å”¯ä¸€è®¿é—®æ¬¡æ•°", type = "n",
  xlim = c(0.5, 7.5),
  ylim = c(0, max(auv)),
  xaxt = "n", panel.first = grid()
)
axis(1, 1:7, sprintf("å‘¨%s", c(
  "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "æ—¥"
)))
rect(1:7 - 0.3, c(0, auv[1:6]), 1:7 + 0.3, auv,
  col = c(NA, ifelse(diff(auv) < 0, "red", NA))
)

```

- SGD
```{r}
# æœ¬ä¾‹çš„ç›®æ ‡å‡½æ•°ä¹Ÿå¯ä»¥ç”¨ R è‡ªèº«çš„ optim() å‡½æ•°æ¥æ±‚æå°å€¼ï¼Œå®ƒçš„æ”¶æ•›ä»£ç ä¸º 0ï¼Œè¡¨ç¤ºè¿™ä¸ªè®¡ç®—ç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹å¯ä»¥æ”¶æ•›ï¼ˆä½†ä¸ä»£è¡¨æ‰¾åˆ°äº†å…¨å±€æœ€å°å€¼ï¼Œç”šè‡³ä¸ä»£è¡¨æ‰¾åˆ°äº†å±€éƒ¨æœ€å°å€¼ï¼‰
f2 <- function(x) sin(1 / 2 * x[1]^2 - 1 / 4 * x[2]^2 + 3) *
    cos(2 * x[1] + 1 - exp(x[2]))
# par ä¸ºå±€éƒ¨è§£ï¼›value ä¸ºç›®æ ‡å‡½æ•°å€¼ï¼› convergence ä¸ºæ”¶æ•›æŒ‡ç¤ºä»£ç 
optim(c(-.9, .9), f2, method = "L-BFGS-B", lower = c(-1, .5), upper = c(1, 2.2))
```
```{r}
demo("gradArrows1", package = "MSG")
```

## 5.20

- çŸ©å½¢ã€å¤šè¾¹å½¢
```{r}
x <- rnorm(40) # äº§ç”Ÿ 40 ä¸ªæ­£æ€éšæœºæ•°
plot(x, xlab = "", type = "l") # ç”»çº¿å›¾
# è¯·æ€è€ƒä¸ºä»€ä¹ˆåæ ‡å€¼è¦è¿™æ ·è®¾ç½®ï¼šå¤šè¾¹å½¢çš„è¿çº¿è·¯å¾„
polygon(c(1, 1:40, 40), c(0, x, 0), col = "gray")
xy <- par("usr") # è·å–å½“å‰å›¾å½¢åŒºåŸŸåæ ‡èŒƒå›´ï¼Œä»¥ä¾¿ä¸‹ç”¨
# ç”¨ç™½è‰²çŸ©å½¢æŒ¡ä½äº† 0 ä»¥ä¸‹çš„éƒ¨åˆ†
rect(xy[1], xy[3], xy[2], 0, col = "white")
lines(x) # é‡ç”»ä¸€é x çš„çº¿æ¡
abline(h = 0, col = "lightgray") # æ·»åŠ æ°´å¹³çº¿
```

- ç½‘æ ¼çº¿ã€æ–‡æœ¬ã€å›¾ä¾‹
```{r}
par(mar = c(4, 4, 4, 3))
plot(0:10, type = "n", xlab = "", ylab = "", xlim = c(0, 12))
grid(col = "gray")
title(
  main = "Demonstration of text in R Graphics",
  xlab = "X-axis title", ylab = "Y-axis title"
)
mtext("Here is \"side = 4\"", side = 4, line = 1)
x <- c(6, 4, 6, 8)
y <- c(8, 5, 2, 5)
s <- c(0, 90, 180, 270)
for (i in 1:4) {
  text(x[i], y[i], sprintf("srt = %d", s[i]), srt = s[i])
}
segments(c(6, 0, 6, 12), c(10, 5, 0, 5), c(0, 6, 12, 6),
  c(5, 0, 5, 10),
  lty = c(2, 1, 1, 2)
)
legend(-0.2, 9.8, c("Upper", "Lower"),
  lty = 2:1, cex = 0.8,
  bty = "n" 
)
```

## 5.19
- ç‚¹
å…³äºç‚¹çš„è®¾ç½®ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥åœ¨å¾ˆå¤šä½œå›¾å‡½æ•°ä¸­ç”¨ `pch`ï¼ˆç‚¹çš„ç¬¦å·ï¼‰ï¼Œ ç­‰å‚æ•°å®ç°ï¼Œä¹Ÿå¯ä»¥åœ¨ç”¨ä½å±‚å‡½æ•° `points()` å‘å·²æœ‰å›¾å½¢ä¸­æ·»åŠ ç‚¹æ¥å®ç°

```{r}
demo("pointTypes", package = "MSG")
```
```{r}
# å…ˆå°†é¸¢å°¾èŠ±çš„ç±»å‹è½¬åŒ–ä¸ºæ•´æ•° 1ã€2ã€3ï¼Œä¾¿äºä½¿ç”¨å‘é‡
idx <- as.integer(iris[["Species"]])
plot(iris[, 3:4],
  pch = c(24, 21, 25)[idx],
  col = c("black", "red", "blue")[idx], panel.first = grid()
)
legend("topleft",
  legend = levels(iris[["Species"]]),
  col = c("black", "red", "blue"), pch = c(24, 21, 25), bty = "n"
)
```
```{r}
par(mar = c(0.2, 0.2, 0.2, 0.2), mfrow = c(2, 2))
for (n in c(63, 60, 76, 74)) {
  set.seed(711)
  plot.new()
  box()
  size <- c(replicate(n, 1 / rbeta(2, 1.5, 4)))
  center <- t(replicate(n, runif(2)))[rep(1:n, each = 2), ]
  color <- paste("#", apply(
    replicate(2 * n, sample(c(0:9, LETTERS[1:6]), 8, TRUE)), 2, paste,
    collapse = ""
  ), sep = "")
  points(center, cex = size, pch = rep(20:21, n), col = color)
}

```
- æ›²çº¿ã€ç›´çº¿ã€çº¿æ®µã€ç®­å¤´ã€X-æ ·æ¡

ç”»çº¿çš„å‡½æ•°ï¼š

1. abline(a = NULL, b = NULL, h = NULL, v = NULL, reg = NULL, coef = NULL,untf = FALSE, ...)
2. segments(x0, y0, x1 = x0, y1 = y0, col = par("fg"), lty = par("lty"),lwd = par("lwd"), ...)
3. arrows(x0, y0, x1 = x0, y1 = y0, length = 0.25, angle = 30, code = 2, col = par("fg"), lty = par("lty"), lwd = par("lwd"), ...)
4. xspline(x, y = NULL, shape = 0, open = TRUE, repEnds = TRUE, draw = TRUE,border = par("fg"), col = NA, ...)
```{r}
# ä¸ä½œå›¾ï¼Œåªç”»å‡ºæ¡†æ¶ï¼Œä¸”æŒ‡å®šåæ ‡è½´èŒƒå›´
plot(1:10, type = "n", xlim = c(0, 10), ylim = c(0, 10))
lines(1:10, abs(rnorm(10))) # 10 ä¸ªæ­£æ€éšæœºæ•°ç»å¯¹å€¼çš„æ³¢åŠ¨çº¿
abline(a = 0, b = 1, col = "gray") # ä¸åŒçš„ç›´çº¿
abline(v = 2, h = 2, lty = 2)
text(8, 3, "abline(a = 0, b = 1)") # æ·»åŠ æ–‡æœ¬
arrows(8, 3.5, 6, 5.7, angle = 40) # æ·»åŠ ç®­å¤´
# å‚æ•°ç”¨äº†å‘é‡ï¼šä¸åŒç°åº¦çš„çº¿æ®µ
segments(rep(3, 4), 6:9, rep(5, 4), 6:9, col = gray(seq(0.2, 0.8, length = 4)))
text(4, 9.8, "segments")
```




## 5.18

- ä»Šå¤©ç ”ç©¶ä¸€ä¸‹é¢œè‰²ï¼
1.  å›ºå®šé¢œè‰²é€‰æ‹©å‡½æ•°
```{r}
# color() 657ç§é¢œè‰²
pdf("colors-bar.pdf", height = 120)
par(mar = c(0, 10, 3, 0) + 0.1, yaxs = "i")
barplot(rep(1, length(colors())),
  col = rev(colors()), names.arg = rev(colors()), horiz = TRUE,
  las = 1, xaxt = "n", main = expression("Bars of colors in" ~ italic(colors()))
)
dev.off()

palette() # é»˜è®¤çš„è°ƒè‰²æ¿é¢œè‰²
palette("default") # æ¢å¤é»˜è®¤è°ƒè‰²æ¿
#æˆ‘ä»¬å¯ä»¥åœ¨ Rä¸­ä½¿ç”¨ä¸€ä¸ªæ•´æ•°æ¥è¡¨ç¤ºé¢œè‰²ï¼Œè€Œè¿™ä¸ªæ•´æ•°å¯¹åº”çš„é¢œè‰²å°±æ˜¯è°ƒè‰²æ¿ä¸­ç›¸åº”ä½ç½®çš„é¢œè‰²
```
2. é¢œè‰²ç”Ÿæˆå’Œè½¬æ¢å‡½æ•°
```{r}
#é¢œè‰²ç”Ÿæˆæ¨¡å‹1: RGB æ¨¡å‹ï¼ˆçº¢ç»¿è“ä¸‰åŸè‰²æ··åˆ)
#2: HSV è‰²å½©æ¨¡å‹,è‰²è°ƒï¼ˆHueï¼‰ã€é¥±å’Œåº¦ï¼ˆSaturationï¼‰å’Œçº¯åº¦ï¼ˆValueï¼‰
# 3: HCL è‰²å½©æ¨¡å‹,è‰²è°ƒï¼ˆHueï¼‰ã€è‰²åº¦ï¼ˆChromaï¼‰å’Œäº®åº¦ï¼ˆLuminanceï¼‰
# 4: ç°è‰²ç”Ÿæˆæ¨¡å‹
barplot(rep(1,5),col = gray(seq(0, 1, length = 5)))
# ä¸¤ç§é¢œè‰²è½¬æ¢å‡½æ•°rgb2hsv()ä¸col2rgb
col2rgb("yellow") # é»„è‰²æ˜¯ç”±çº¢ç»¿æ··åˆå¾—åˆ°çš„
```
3. è°ƒè‰²æ¿
```{r}
library(RColorBrewer)
layout(matrix(1:3, 3), heights = c(2, 1, 1))
par(mar = c(0, 4, 0, 0))
display.brewer.all(type = "seq") # è¿ç»­å‹ï¼š18 ç§
display.brewer.all(type = "div") # æç«¯åŒ–ï¼š9 ç§
display.brewer.all(type = "qual") # ç¦»æ•£å‹ï¼š8 ç§
```

```{r}
xx <- c(1912, 1912:1971, 1971)
yy <- c(min(nhtemp), nhtemp, min(nhtemp))
plot(xx, yy, type = "n", xlab = "Year", ylab = "Temperatures")#æ— å›¾
for (i in seq(255, 0, -3)) {
  yy <- c(45, nhtemp - (nhtemp - min(nhtemp)) * (1 - i / 255), 45) # rgb() ä¸­çš„ç»¿è‰²æˆåˆ†é€æ¸å˜å°
  polygon(xx, yy, col = rgb(1, i / 255, 0), border = NA)
  Sys.sleep(0.05)
  # è¯»è€…å¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸Š Sys.sleep(0.05) ä»¥ä¾¿çœ‹æ¸…ä½œå›¾è¿‡ç¨‹
}
box() # è¡¥é½è¾¹æ¡†

```
4. é¢œè‰²æ··åˆ
```{r}
#out = alpha * new + (1 - alpha) * old
x <- rgb(1, seq(0, 1, length = 30), 0)
barplot(rep(1, 30), col = x)
# ä¸‰åŸè‰²
x = rep(1,6)
names(x) = c("red","green","blue","magenta","yellow","cyan")
red = rgb(1,0,0,1)
green = rgb(0,1,0,1)
blue = rgb(0,0,1,1)
magenta = rgb(1,0,1,1)
yellow = rgb(1,1,0)
cyan = rgb(0,1,1)
barplot(x,col=c(red,green,blue,magenta,yellow,cyan) )
```

## 5.17

```{r}
troops <- read.table(system.file("extdata", "troops.txt", package = "MSG"), header = TRUE)
cities <- read.table(system.file("extdata", "cities.txt", package = "MSG"), header = TRUE)
library(ggplot2)
p <- ggplot(cities, aes(x = long, y = lat)) # æ¡†æ¶
p <- p + geom_path(aes(size = survivors, colour = direction, group = group), 
                   data = troops, lineend = "round") # å†›é˜Ÿè·¯çº¿
p <- p + geom_point() # åŸå¸‚ç‚¹
p <- p + geom_text(aes(label = city), hjust = 0, vjust = 1, size = 2.5) # åŸå¸‚åç§°
p <- p + scale_colour_manual(values = c("grey50", "red")) + 
  scale_size(range = c(1, 10)) +
  theme(legend.position = "none") + 
  xlim(24, 39) # ç»†èŠ‚è°ƒæ•´å·¥ä½œ
print(p) # æ‰“å°å…¨å›¾

```

-   R çš„ç¼–ç¨‹æ–¹å¼æ˜¯é¢å‘å¯¹è±¡ï¼ˆObject-Orientedï¼‰çš„
-   å‘é‡ï¼š

```{r}
1:10
c(7.11, 9.11, 9.19, 1.23)
x <- c(7.11, 9.11, 9.19, 1.23)
x[c(1, 4)]
sort(x)
seq(7,9,0.2)
seq(7, 9, length.out = 6)#ç”Ÿæˆå‘é‡é•¿åº¦ä¸º 6
rep(1:3, 5)
rep(1:3, each = 5)
```

-   å› å­

```{r}
x <- factor(c(1, 2, 3, 1, 1, 3, 2, 3, 3), levels = 1:3, labels = c("g1", "g2", "g3"))
#æˆ‘ä»¬å¯ä»¥å¯¹å› å­å‹æ•°æ®æ±‚é¢‘æ•°ã€å°†å…¶è½¬åŒ–ä¸ºæ•´æ•°æˆ–å­—ç¬¦å‹å‘é‡ã€‚
table(x)
as.integer(x)
as.character(x)
#å› å­å‹æ•°æ®åœ¨åˆ†ç±»æ±‡æ€»æ—¶æ¯”è¾ƒæœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨ tapply() ä¸­ï¼š
y <- 1:9
data.frame(y, x) # x å’Œ y å¹¶åˆ—æ”¾çš„æ ·å­
tapply(y, x, mean) # x çš„æ¯ä¸€ç»„çš„å‡å€¼
#å®šåºå˜é‡:ä¸æ­¤ç›¸å…³çš„å‡½æ•°ä¸º ordered()
```

-   æ•°ç»„å’ŒçŸ©é˜µ

æ•°ç»„å’ŒçŸ©é˜µå¯ä»¥åˆ†åˆ«ç”±`array()`å’Œ`matrix()` å‡½æ•°ç”Ÿæˆ

```{r}
x <- array(1:24, c(3, 4, 2)) # 3 ç»´æ•°ç»„ç¤ºä¾‹
dim(x)
x <- matrix(1:12, nrow = 2, ncol = 6) # çŸ©é˜µç¤ºä¾‹
# ä¸€ä¸ªéšæœºæ–¹é˜µ
(x <- matrix(c(2, 9, 4, 5, 6, 8, 1, 3, 7), 3))
solve(x)
```

-   æ•°æ®æ¡†å’Œåˆ—è¡¨

æ•°æ®æ¡†ï¼ˆdata frameï¼‰å’Œåˆ—è¡¨ï¼ˆlistï¼‰æ˜¯ R ä¸­éå¸¸çµæ´»çš„æ•°æ®ç»“æ„

```{r}
# ç”Ÿæˆä¸€ä¸ªæ•°æ®æ¡†ï¼Œå‰ä¸¤åˆ—ä¸ºæ•°å€¼å‹ï¼Œåä¸€åˆ—ä¸ºå­—ç¬¦å‹
data.frame(x = rnorm(5), y = runif(5), z = letters[1:5])
# åŒ…å«å››ä¸ªå­å¯¹è±¡çš„åˆ—è¡¨
Lst <- list(name = "Fred", wife = "Mary", no.children = 3, child.ages = c(4, 7, 9))
```

-   çŸ©é˜µçš„æœ¬è´¨æ˜¯ï¼ˆå¸¦æœ‰ç»´åº¦å±æ€§çš„ï¼‰å‘é‡ï¼Œæ•°æ®æ¡†çš„æœ¬è´¨æ˜¯ï¼ˆæ•´é½çš„ï¼‰åˆ—è¡¨ã€‚

-   å‡½æ•°

```{r}
kurtosis <- function(x, na.rm = FALSE) {
  # å»æ‰ç¼ºå¤±å€¼
  if (na.rm) x <- x[!is.na(x)]
  return(sum((x - mean(x))^4) / (length(x) * var(x)^2) - 3)
}#è¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œæ•°æ®å‘é‡xå’Œæ˜¯å¦åˆ é™¤ç¼ºå¤±å€¼ na.rmï¼Œåè€…æœ‰é»˜è®¤å€¼ FALSEï¼›
kurtosis(runif(100))
#æ³›å‹å‡½æ•° ï¼ˆgeneric functionï¼‰ä¼ ç»™ plot() çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½•ç§ç±»ï¼Œåˆ™è°ƒç”¨ä½•ç§å‡½æ•°è¿›è¡Œä½œå›¾
head(methods("plot"), 24) # æ˜¾ç¤ºå‰24ä¸ª
class(iris)
plot(iris) # è°ƒç”¨ plot.data.frame() ä½œæ•£ç‚¹å›¾çŸ©é˜µ
x <- density(faithful$waiting)
class(x)
par(mar = c(4, 4, 3, 0.5))
plot(x) # è°ƒç”¨ plot.density() ä½œå¯†åº¦æ›²çº¿
```

## 5.16

ğŸ’ğŸ’ğŸ’å¬å¤§ä½¬è®²åº§ï¼ [å¤§ä½¬è®²åº§ppté“¾æ¥](https://connect.xjtlu.edu.cn/interaction/forum/topic.php?id=1132)

    library(animation)
    plot.new()
    for (i in 1:30){
        points(runif(1), runif(1), pch = 19, cex = 2)
        Sys.sleep(0.2)
    }

```{r, animation.hook='gifski'}
for (i in 1:20){
    hist(rnorm(20))
}
```

## 5.14

åƒçš„å¤ªé¥±å®¹æ˜“çŠ¯å›°ğŸ˜µ

-   æ¡å½¢å›¾

```{r}
# Load vcd package
library(vcd)
# Get cell counts for improved variable
counts <- table(Arthritis$Improved)
counts
# simple bar plot
barplot(counts, main = "Simple Bar Plot", xlab = "Improvement", ylab = "Frequency")

# horizontal bar plot
barplot(counts, main = "Horizontal Bar Plot", xlab = "Frequency", ylab = "Improvement", horiz = TRUE)
# get counts for Improved by Treatment table
counts <- table(Arthritis$Improved,Arthritis$Treatment)
counts
# stacked barplot
barplot(counts, main = "Stacked Bar Plot", xlab = "Treatment", ylab = "Frequency", col = c("red", "yellow", "green"), legend = rownames(counts))

# grouped barplot
barplot(counts, main = "Grouped Bar Plot", xlab = "Treatment", ylab = "Frequency", col = c("red", "yellow", "green"), legend = rownames(counts), beside = TRUE)
# Mean bar plots
states <- data.frame(state.region, state.x77)
means <- aggregate(states$Illiteracy, 
    by = list(state.region), 
    FUN = mean)
means
means <- means[order(means$x), ]
means
barplot(means$x, names.arg = means$Group.1)
title("Mean Illiteracy Rate")
#ä¸ºæ£˜çŠ¶å›¾ï¼ˆspinogramï¼‰
attach(Arthritis) 
counts <- table(Treatment, Improved) 
spine(counts, main="Spinogram Example") 
detach(Arthritis) 
```

## 5.13

ç¡å¾—å¥½æ˜¯çœŸçš„å¾ˆé‡è¦å‘€

```{r}
options(digits=2)#)é™å®šäº†è¾“å‡ºå°æ•°ç‚¹åæ•°å­—ä½æ•°
Student <- c("John Davis", "Angela Williams", 
    "Bullwinkle Moose", "David Jones", 
    "Janice Markhammer", "Cheryl Cushing",
    "Reuven Ytzrhak", "Greg Knox", "Joel England",
    "Mary Rayburn")
Math <- c(502, 600, 412, 358, 495, 512, 410, 625, 573, 522)
Science <- c(95, 99, 80, 82, 75, 85, 80, 95, 89, 86)
English <- c(25, 22, 18, 15, 20, 28, 15, 30, 27, 18)
roster <- data.frame(Student, Math, Science, English,stringsAsFactors=FALSE)
    
z <- scale(roster[,2:4]) #å°†å˜é‡è¿›è¡Œæ ‡å‡†åŒ–

score <- apply(z, 1, mean)                     
roster <- cbind(roster, score)
#é€šè¿‡å‡½æ•°mean()æ¥è®¡ç®—å„è¡Œçš„å‡å€¼ä»¥è·å¾—ç»¼åˆå¾—åˆ†ï¼Œå¹¶ä½¿ç”¨å‡½æ•°cbind()å°†å…¶æ·»åŠ åˆ°èŠ±åå†Œä¸­ 
y <- quantile(score, c(.8,.6,.4,.2)) #å‡½æ•°quantile()ç»™å‡ºäº†å­¦ç”Ÿç»¼åˆå¾—åˆ†çš„ç™¾åˆ†ä½æ•°                                  
roster$grade[score >= y[1]] <- "A"           
roster$grade[score < y[1] & score >= y[2]] <- "B"
roster$grade[score < y[2] & score >= y[3]] <- "C"
roster$grade[score < y[3] & score >= y[4]] <- "D"
roster$grade[score < y[4]] <- "F"

name <- strsplit((roster$Student), " ") #ä½¿ç”¨å‡½æ•°strsplit()ä»¥ç©ºæ ¼ä¸ºç•ŒæŠŠå­¦ç”Ÿå§“åæ‹†åˆ†ä¸ºå§“æ°å’Œåå­—           
#ä½ å¯ä»¥ä½¿ç”¨å‡½æ•°sapply()æå–åˆ—è¡¨ä¸­æ¯ä¸ªæˆåˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ”¾å…¥ä¸€ä¸ªå‚¨å­˜åå­—çš„å‘é‡Firstnameï¼Œå¹¶æå–æ¯ä¸ªæˆåˆ†çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ”¾å…¥ä¸€ä¸ªå‚¨å­˜å§“æ°çš„å‘é‡Lastnameã€‚"["æ˜¯ä¸€ä¸ªå¯ä»¥æå–æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†çš„å‡½æ•°â€”â€”åœ¨è¿™é‡Œå®ƒæ˜¯ç”¨æ¥æå–åˆ—è¡¨nameå„æˆåˆ†ä¸­çš„ç¬¬ä¸€ä¸ªæˆ–ç¬¬äºŒä¸ªå…ƒç´ çš„ã€‚
lastname <- sapply(name, "[", 2)
firstname <- sapply(name, "[", 1)

roster <- cbind(firstname,lastname, roster[,-1])
roster <- roster[order(lastname,firstname),]

roster
```

```{r}
# for
for (i in 1:10) 
    print(i)
# while
i <- 10 
while (i > 0) {
    print(i)
    i <- i - 1} 
```

-   if

    -   `if (cond) statement1 else statement2`
    -   `ifelse(cond, statement1, statement2)`

-   switch `switch(expr, ...)`

```{r}
mydate <- function(type="long") {
    switch(type,
    long =  format(Sys.time(), "%A %B %d %Y"), 
    short = format(Sys.time(), "%m-%d-%y"),
    cat(type, "is not a recognized type\n"))
}
mydate("long")
mydate("short")
mydate()
mydate("medium")
```

-   å‡½æ•°

<!-- -->

    myfunction <- function(arg1, arg2, ... ){ 
     statements 
     return(object) 
    } 

![](5.jpg)

-   åŒ…reshape2 `æ•°melt()å’Œdcast()`

## 5.12

æ˜¨æ™šæ˜¯è¢«èšŠå­æ¯æ‰çš„ç¡çœ ï¼

```{r}
x <- c(1, 2, 3, 4, 5, 6, 7, 8)
mean(x)
sd(x)
```

![](2.jpg)

```{r}
# normal distribution
library(MASS)
options(digits=3)
set.seed(1234)
mean <- c(230.7, 146.7, 3.6)           
sigma <- matrix( c(15360.8, 6721.2, -47.1,                           6721.2, 4700.9, -16.5,
            -47.1,  -16.5,   0.3), nrow=3, ncol=3)
mydata <- mvrnorm(500, mean, sigma)             
mydata <- as.data.frame(mydata)                   
names(mydata) <- c("y", "x1", "x2")               
dim(mydata)
head(mydata, n=10)   
```

-   å­—ç¬¦ä¸²å¤„ç†å‡½æ•°
-   å…¶ä»–æœ‰ç”¨å‡½æ•° ![](4.jpg)
-   Rä¸­æä¾›äº†ä¸€ä¸ª`apply()`å‡½æ•°ï¼Œå¯å°†ä¸€ä¸ªä»»æ„å‡½æ•°"åº”ç”¨"åˆ°çŸ©é˜µã€æ•°ç»„ã€æ•°æ®æ¡†çš„ä»»ä½•ç»´ åº¦ä¸Šã€‚`apply()`å‡½æ•°çš„ä½¿ç”¨æ ¼å¼ä¸ºï¼š `apply(x, MARGIN, FUN, ...)`

## 5.11

ç­”è¾©è®©æˆ‘å¥½ç–²æƒ«ã€‚ã€‚

-   æ—¥æœŸ

```{r}
mydates <- as.Date(c("2007-06-22","2004-02-13")) 
today <- Sys.Date() 
format(today, format="%B %d %Y") 
dob <- as.Date("2000-01-02")
difftime(today, dob, units="weeks") 
#strDates <- as.character(dates)å°†æ—¥æœŸè½¬ä¸ºå­—ç¬¦
```

![](1.jpg)

```{r}
a <- c(1, 2, 3)
a
is.numeric(a)
is.vector(a)
a <- as.character(a)
a
is.numeric(a)
is.vector(a)
is.character(a)
```

-   ä½¿ç”¨`order()`å‡½æ•°å¯¹ä¸€ä¸ªæ•°æ®æ¡†è¿›è¡Œæ’åºã€‚é»˜è®¤çš„æ’åºé¡ºåºæ˜¯å‡åºã€‚åœ¨æ’åºå˜é‡çš„å‰è¾¹åŠ ä¸€ä¸ªå‡å·å³å¯å¾—åˆ°é™åºçš„æ’åºç»“æœ
-   æ¨ªå‘åˆå¹¶ä¸¤ä¸ªæ•°æ®æ¡†ï¼ˆæ•°æ®é›†ï¼‰ï¼Œä½¿ç”¨`merge()`å‡½æ•°ï¼Œ`rbind(),cbind()`
-   `subset()`å‡½æ•°å¤§æ¦‚æ˜¯é€‰æ‹©å˜é‡å’Œè§‚æµ‹æœ€ç®€å•çš„æ–¹æ³•
-   `sample()`å‡½æ•°èƒ½å¤Ÿè®©ä½ ä»æ•°æ®é›†ä¸­ï¼ˆæœ‰æ”¾å›æˆ–æ— æ”¾å›åœ°ï¼‰æŠ½å–å¤§å°ä¸ºnçš„ä¸€ä¸ªéšæœºæ ·æœ¬

```{r}
library(sqldf)
newdf <- sqldf("select * from mtcars where carb=1 order by mpg", 
    row.names = TRUE)
newdf <- sqldf("select avg(mpg) as avg_mpg, avg(disp) as avg_disp,
    gear from mtcars where cyl in (4, 6) group by gear")
```

## 5.10

```{r}
mydata <- data.frame(x1 = c(2, 2, 6, 4), x2 = c(3, 4, 2, 8))
mydata$sumx <- mydata$x1 + mydata$x2
mydata$meanx <- (mydata$x1 + mydata$x2)/2
attach(mydata)
mydata$sumx <- x1 + x2
mydata$meanx <- (x1 + x2)/2
detach(mydata)
mydata <- transform(mydata, sumx = x1 + x2, meanx = (x1 + x2)/2)
```

-   plyråŒ…ä¸­æœ‰ä¸€ä¸ª`rename()`å‡½æ•°ï¼Œå¯ç”¨äºä¿®æ”¹å˜é‡å

```{r}
y <- c(1, 2, 3, NA) 
print(is.na(y))
x <- c(1, 2, NA, 3) 
print(sum(x, na.rm=TRUE))
```

-   `na.omit()`å¯ä»¥åˆ é™¤æ‰€æœ‰å«æœ‰ç¼ºå¤±æ•°æ®çš„è¡Œ

## 5.9

```{r}
attach(mtcars)
plot(wt, mpg)
abline(lm(mpg ~ wt))
title("Regression of MPG on Weight")
detach(mtcars)
```

-   å¯ç”¨`par(optionname=value,optionname=name,...)`ä¿®æ”¹å›¾å½¢å‚æ•°ï¼Œä¹Ÿå¯ç”¨é«˜çº§ç»˜å›¾å‡½æ•°ç›´æ¥æä¾›çš„optionname=valueçš„é”®å€¼å¯¹
-   å‡½æ•°`colors()`å¯ä»¥è¿”å›æ‰€æœ‰å¯ç”¨é¢œè‰²çš„åç§°
-   å‡½æ•°`plotmath()`å¯ä»¥ä¸ºå›¾å½¢ä¸»ä½“æˆ–è¾¹ç•Œä¸Šçš„æ ‡é¢˜ã€åæ ‡è½´åç§°æˆ–æ–‡æœ¬æ ‡æ³¨æ·»åŠ æ•°å­¦ç¬¦å·
-   `layout()`ğŸ‘

## 5.8

```{r}
#çŸ©é˜µ
y = matrix(1:20,nrow = 5, ncol = 4)
y
cells <- c(1, 26, 24, 68)
rnames <- c("R1", "R2")
cnames <- c("C1", "C2")
mymatrix <- matrix(cells, nrow = 2, ncol = 2, byrow = TRUE, 
    dimnames = list(rnames, cnames))
mymatrix
mymatrix <- matrix(cells, nrow = 2, ncol = 2, byrow = FALSE, 
    dimnames = list(rnames, cnames))
mymatrix
#æ•°ç»„ï¼šä¸ªåˆ›å»ºä¸‰ç»´ï¼ˆ2Ã—3Ã—4ï¼‰æ•°å€¼å‹æ•°ç»„
dim1 <- c("A1", "A2")
dim2 <- c("B1", "B2", "B3")
dim3 <- c("C1", "C2", "C3", "C4")
z <- array(1:24, c(2, 3, 4), dimnames = list(dim1, dim2, dim3))
z
```

```{r}
#åˆ›å»ºæ•°æ®æ¡†
patientID <- c(1, 2, 3, 4)
age <- c(25, 34, 28, 52)
diabetes <- c("Type1", "Type2", "Type1", "Type1")
status <- c("Poor", "Improved", "Excellent", "Poor")
patientdata <- data.frame(patientID, age, diabetes, 
    status)
patientdata
patientdata$age
table(patientdata$diabetes, patientdata$status)#ç”Ÿæˆç³–å°¿ç—…ç±»å‹å˜é‡diabeteså’Œç—…æƒ…å˜é‡statusçš„åˆ—è”è¡¨
```

-   å‡½æ•°attach()å¯å°†æ•°æ®æ¡†æ·»åŠ åˆ°Rçš„æœç´¢è·¯å¾„ä¸­ã€‚Råœ¨é‡åˆ°ä¸€ä¸ªå˜é‡åä»¥åï¼Œå°†æ£€æŸ¥æœç´¢è·¯å¾„ä¸­çš„æ•°æ®æ¡†ï¼Œä½†æ˜¯[Rä»£ç é£æ ¼è¯´æ˜](https://google.github.io/styleguide/Rguide.html)é‡Œè¯´æœ€å¥½ä¸è¦ç”¨å™¢å“ˆå“ˆå“ˆ
-   **with**
-   ç±»åˆ«ï¼ˆåä¹‰å‹ï¼‰å˜é‡å’Œæœ‰åºç±»åˆ«ï¼ˆæœ‰åºå‹ï¼‰å˜é‡åœ¨Rä¸­ç§°ä¸ºå› å­ï¼ˆfactorï¼‰

```{r}
patientID <- c(1, 2, 3, 4)
age <- c(25, 34, 28, 52)
diabetes <- c("Type1", "Type2", "Type1", "Type1")
status <- c("Poor", "Improved", "Excellent", "Poor")
diabetes <- factor(diabetes)
status <- factor(status, order = TRUE)
patientdata <- data.frame(patientID, age, diabetes, status)
str(patientdata)
```

-   edit() å¯ä»¥ä¿®æ”¹æ•°æ®

## 5.7

```{r}
help.start()
help(package = "vcd")
library(vcd) 
help(Arthritis) #é˜…è¯»æ•°æ®é›†Arthritisçš„æè¿°
Arthritis 
example(Arthritis)# è¿è¡Œæ•°æ®é›†Arthritisè‡ªå¸¦çš„ç¤ºä¾‹
#q()
```
