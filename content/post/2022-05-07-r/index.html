---
title: "R每日随心记"
author: "zyy"
date: '2022-05-07'
slug: r
categories: []
tags: []
---



<p>这三种语言说熟悉也熟悉，但总觉得缺乏一种系统感，那就每天花点时间浏览一些书籍记录一下吧！</p>
<p>书籍列表(更新中)：</p>
<ul>
<li>R语言实战(第2版)</li>
<li><a href="https://bookdown.org/xiangyun/msg/">现代统计图形</a></li>
</ul>
<pre class="r"><code>knitr::opts_chunk$set(echo = T,collapse = T,
                      results = &quot;hide&quot;)</code></pre>
<div id="section" class="section level2">
<h2>5.28</h2>
<ul>
<li>等高线</li>
<li>条件分布</li>
<li>一元函数曲线</li>
</ul>
<pre class="r"><code>par(par(mar = c(4.5, 4, 0.2, 0.2)), mfrow = c(2, 1))
chippy &lt;- function(x) sin(cos(x) * exp(-x / 2))
curve(chippy, -8, 7, n = 2008, xlab = &quot;$x$&quot;, ylab = &quot;$\\mathrm{chippy}(x)$&quot;)
curve(sin(x) / x, from = -20, to = 20, n = 200, 
      xlab = &quot;$t$&quot;, ylab = &quot;$\\varphi_{X}(t)$&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>
<div id="section-1" class="section level2">
<h2>5.27</h2>
<p>以后以日期为准，不以今天、明天这样含糊的词语</p>
<pre class="r"><code>(x &lt;- margin.table(HairEyeColor, c(1, 2)))
assocplot(x)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="section-2" class="section level2">
<h2>5.26</h2>
<ul>
<li><p>箱线图（boxplot）</p></li>
<li><p>条形图</p></li>
</ul>
<pre class="r"><code>library(RColorBrewer) # 用分类调色板
par(mfrow = c(2, 1), mar = c(3, 2.5, 0.5, 0.1))
death &lt;- t(VADeaths)[, 5:1]
barplot(death, col = brewer.pal(4, &quot;Set1&quot;))
barplot(death,
  col = brewer.pal(4, &quot;Set1&quot;), beside = TRUE,
  legend.text = TRUE
)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-3-1.png" width="672" />
- 散点图</p>
<pre class="r"><code>demo(&quot;alphaDemo&quot;, package = &quot;MSG&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="section-3" class="section level2">
<h2>5.25</h2>
<ul>
<li>bootstrap方法</li>
</ul>
<pre class="r"><code>x=c(18.2,9.5,12.0,21.1,10.2)
theta&lt;-median(x)
bootstrap&lt;-function(x,B=10000){
        set.seed(123)
        G&lt;-matrix(0,B,length(x))
        for(i in 1:B){
                G[i,]&lt;-t(matrix(sample(x,length(x),replace = T)))
        }
        return(G)
}
#运行时间
tic&lt;-proc.time()
b&lt;-matrix(apply(bootstrap(x),1,median),1)
toc&lt;-proc.time()
print(toc-tic)
#误差计算
(sd&lt;-sqrt(((b)-mean(b))%*%(t(b)-mean(b))/(length(b)-1)))
(mean(b))</code></pre>
<ul>
<li>茎叶图（Stem-and-Leaf Plot）</li>
</ul>
<pre class="r"><code>head(islands, 10)#该数据记录了世界上各大陆地块的面积大小，原始数据前 10 条如下（单位：千平方英里）
stem(islands)
# 均值 lambda 为 10 的泊松分布随机数
sort(x &lt;- rpois(80, lambda = 10))
stem(x, scale = 2)</code></pre>
</div>
<div id="section-4" class="section level2">
<h2>5.23</h2>
<p>peer pressure</p>
<ul>
<li>直方图（Histogram）</li>
</ul>
<pre class="r"><code>par(mfrow = c(2, 2), mar = c(2, 3, 2, .5), mgp = c(2, .5, 0))
data(geyser, package = &quot;MASS&quot;)
hist(geyser$waiting, main = &quot;(1) freq = TRUE&quot;, xlab = &quot;waiting&quot;)
hist(geyser$waiting, freq = FALSE, xlab = &quot;waiting&quot;, main = &quot;(2) freq = FALSE&quot;)
hist(geyser$waiting, breaks = 5, density = 10, xlab = &quot;waiting&quot;, main = &quot;(3) breaks = 5&quot;)
hist(geyser$waiting, breaks = 40, col = &quot;red&quot;, xlab = &quot;waiting&quot;, main = &quot;(4) breaks = 40&quot;)

library(ggplot2)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>library(cowplot)
## Warning: 程辑包&#39;cowplot&#39;是用R版本4.0.5 来建造的
p &lt;- ggplot(aes(waiting), data = geyser)
p1 &lt;- p + geom_histogram(breaks = seq(40, 110, by = 5))
p2 &lt;- p + geom_histogram(breaks = seq(40, 110, by = 5), aes(y = ..density..))
p3 &lt;- p + geom_histogram(breaks = seq(40, 110, by = 10))
p4 &lt;- p + geom_histogram(breaks = seq(42, 108, by = 2), fill = &quot;red&quot;, color = &quot;black&quot;)
plot_grid(p1, p2, p3, p4, labels = c(
  &quot;(1) freq = TRUE&quot;,
  &quot;(2) freq = FALSE&quot;,
  &quot;(3) breaks = 5&quot;,
  &quot;(4) breaks = 40&quot;
), ncol = 2)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<pre class="r"><code>demo(&quot;hist_geyser&quot;, package = &quot;MSG&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>df &lt;- data.frame(
  x = seq(40, 110, 5), y = 0,
  xend = seq(40, 110, 5), yend = ht
)
p2 + geom_density(fill = &quot;lightgray&quot;, color = &quot;black&quot;) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend),
    data = df, lty = 3
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
</div>
<div id="section-5" class="section level2">
<h2>5.21</h2>
<ul>
<li>瀑布图</li>
</ul>
<pre class="r"><code># 七天之内的唯一访问次数数据（周一为 2010 年 8 月 2 日）
auv &lt;- c(939, 1005, 973, 910, 875, 658, 688)
# 相邻两天作差
diff(auv)
par(mar = c(4, 4, .5, .1))
plot(auv,
  xlab = &quot;八月第一周&quot;,
  ylab = &quot;绝对唯一访问次数&quot;, type = &quot;n&quot;,
  xlim = c(0.5, 7.5),
  ylim = c(0, max(auv)),
  xaxt = &quot;n&quot;, panel.first = grid()
)
axis(1, 1:7, sprintf(&quot;周%s&quot;, c(
  &quot;一&quot;, &quot;二&quot;, &quot;三&quot;, &quot;四&quot;, &quot;五&quot;, &quot;六&quot;, &quot;日&quot;
)))
rect(1:7 - 0.3, c(0, auv[1:6]), 1:7 + 0.3, auv,
  col = c(NA, ifelse(diff(auv) &lt; 0, &quot;red&quot;, NA))
)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<ul>
<li>SGD</li>
</ul>
<pre class="r"><code># 本例的目标函数也可以用 R 自身的 optim() 函数来求极小值，它的收敛代码为 0，表示这个计算结果在一定条件下可以收敛（但不代表找到了全局最小值，甚至不代表找到了局部最小值）
f2 &lt;- function(x) sin(1 / 2 * x[1]^2 - 1 / 4 * x[2]^2 + 3) *
    cos(2 * x[1] + 1 - exp(x[2]))
# par 为局部解；value 为目标函数值； convergence 为收敛指示代码
optim(c(-.9, .9), f2, method = &quot;L-BFGS-B&quot;, lower = c(-1, .5), upper = c(1, 2.2))</code></pre>
<pre class="r"><code>demo(&quot;gradArrows1&quot;, package = &quot;MSG&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="section-6" class="section level2">
<h2>5.20</h2>
<ul>
<li>矩形、多边形</li>
</ul>
<pre class="r"><code>x &lt;- rnorm(40) # 产生 40 个正态随机数
plot(x, xlab = &quot;&quot;, type = &quot;l&quot;) # 画线图
# 请思考为什么坐标值要这样设置：多边形的连线路径
polygon(c(1, 1:40, 40), c(0, x, 0), col = &quot;gray&quot;)
xy &lt;- par(&quot;usr&quot;) # 获取当前图形区域坐标范围，以便下用
# 用白色矩形挡住了 0 以下的部分
rect(xy[1], xy[3], xy[2], 0, col = &quot;white&quot;)
lines(x) # 重画一遍 x 的线条
abline(h = 0, col = &quot;lightgray&quot;) # 添加水平线</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<ul>
<li>网格线、文本、图例</li>
</ul>
<pre class="r"><code>par(mar = c(4, 4, 4, 3))
plot(0:10, type = &quot;n&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(0, 12))
grid(col = &quot;gray&quot;)
title(
  main = &quot;Demonstration of text in R Graphics&quot;,
  xlab = &quot;X-axis title&quot;, ylab = &quot;Y-axis title&quot;
)
mtext(&quot;Here is \&quot;side = 4\&quot;&quot;, side = 4, line = 1)
x &lt;- c(6, 4, 6, 8)
y &lt;- c(8, 5, 2, 5)
s &lt;- c(0, 90, 180, 270)
for (i in 1:4) {
  text(x[i], y[i], sprintf(&quot;srt = %d&quot;, s[i]), srt = s[i])
}
segments(c(6, 0, 6, 12), c(10, 5, 0, 5), c(0, 6, 12, 6),
  c(5, 0, 5, 10),
  lty = c(2, 1, 1, 2)
)
legend(-0.2, 9.8, c(&quot;Upper&quot;, &quot;Lower&quot;),
  lty = 2:1, cex = 0.8,
  bty = &quot;n&quot; 
)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="section-7" class="section level2">
<h2>5.19</h2>
<ul>
<li>点
关于点的设置，我们既可以在很多作图函数中用 <code>pch</code>（点的符号）， 等参数实现，也可以在用低层函数 <code>points()</code> 向已有图形中添加点来实现</li>
</ul>
<pre class="r"><code>demo(&quot;pointTypes&quot;, package = &quot;MSG&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code># 先将鸢尾花的类型转化为整数 1、2、3，便于使用向量
idx &lt;- as.integer(iris[[&quot;Species&quot;]])
plot(iris[, 3:4],
  pch = c(24, 21, 25)[idx],
  col = c(&quot;black&quot;, &quot;red&quot;, &quot;blue&quot;)[idx], panel.first = grid()
)
legend(&quot;topleft&quot;,
  legend = levels(iris[[&quot;Species&quot;]]),
  col = c(&quot;black&quot;, &quot;red&quot;, &quot;blue&quot;), pch = c(24, 21, 25), bty = &quot;n&quot;
)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>par(mar = c(0.2, 0.2, 0.2, 0.2), mfrow = c(2, 2))
for (n in c(63, 60, 76, 74)) {
  set.seed(711)
  plot.new()
  box()
  size &lt;- c(replicate(n, 1 / rbeta(2, 1.5, 4)))
  center &lt;- t(replicate(n, runif(2)))[rep(1:n, each = 2), ]
  color &lt;- paste(&quot;#&quot;, apply(
    replicate(2 * n, sample(c(0:9, LETTERS[1:6]), 8, TRUE)), 2, paste,
    collapse = &quot;&quot;
  ), sep = &quot;&quot;)
  points(center, cex = size, pch = rep(20:21, n), col = color)
}</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-16-1.png" width="672" />
- 曲线、直线、线段、箭头、X-样条</p>
<p>画线的函数：</p>
<ol style="list-style-type: decimal">
<li>abline(a = NULL, b = NULL, h = NULL, v = NULL, reg = NULL, coef = NULL,untf = FALSE, …)</li>
<li>segments(x0, y0, x1 = x0, y1 = y0, col = par(“fg”), lty = par(“lty”),lwd = par(“lwd”), …)</li>
<li>arrows(x0, y0, x1 = x0, y1 = y0, length = 0.25, angle = 30, code = 2, col = par(“fg”), lty = par(“lty”), lwd = par(“lwd”), …)</li>
<li>xspline(x, y = NULL, shape = 0, open = TRUE, repEnds = TRUE, draw = TRUE,border = par(“fg”), col = NA, …)</li>
</ol>
<pre class="r"><code># 不作图，只画出框架，且指定坐标轴范围
plot(1:10, type = &quot;n&quot;, xlim = c(0, 10), ylim = c(0, 10))
lines(1:10, abs(rnorm(10))) # 10 个正态随机数绝对值的波动线
abline(a = 0, b = 1, col = &quot;gray&quot;) # 不同的直线
abline(v = 2, h = 2, lty = 2)
text(8, 3, &quot;abline(a = 0, b = 1)&quot;) # 添加文本
arrows(8, 3.5, 6, 5.7, angle = 40) # 添加箭头
# 参数用了向量：不同灰度的线段
segments(rep(3, 4), 6:9, rep(5, 4), 6:9, col = gray(seq(0.2, 0.8, length = 4)))
text(4, 9.8, &quot;segments&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="section-8" class="section level2">
<h2>5.18</h2>
<ul>
<li>今天研究一下颜色！</li>
</ul>
<ol style="list-style-type: decimal">
<li>固定颜色选择函数</li>
</ol>
<pre class="r"><code># color() 657种颜色
pdf(&quot;colors-bar.pdf&quot;, height = 120)
par(mar = c(0, 10, 3, 0) + 0.1, yaxs = &quot;i&quot;)
barplot(rep(1, length(colors())),
  col = rev(colors()), names.arg = rev(colors()), horiz = TRUE,
  las = 1, xaxt = &quot;n&quot;, main = expression(&quot;Bars of colors in&quot; ~ italic(colors()))
)
dev.off()

palette() # 默认的调色板颜色
palette(&quot;default&quot;) # 恢复默认调色板
#我们可以在 R中使用一个整数来表示颜色，而这个整数对应的颜色就是调色板中相应位置的颜色</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>颜色生成和转换函数</li>
</ol>
<pre class="r"><code>#颜色生成模型1: RGB 模型（红绿蓝三原色混合)
#2: HSV 色彩模型,色调（Hue）、饱和度（Saturation）和纯度（Value）
# 3: HCL 色彩模型,色调（Hue）、色度（Chroma）和亮度（Luminance）
# 4: 灰色生成模型
barplot(rep(1,5),col = gray(seq(0, 1, length = 5)))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code># 两种颜色转换函数rgb2hsv()与col2rgb
col2rgb(&quot;yellow&quot;) # 黄色是由红绿混合得到的</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>调色板</li>
</ol>
<pre class="r"><code>library(RColorBrewer)
layout(matrix(1:3, 3), heights = c(2, 1, 1))
par(mar = c(0, 4, 0, 0))
display.brewer.all(type = &quot;seq&quot;) # 连续型：18 种
display.brewer.all(type = &quot;div&quot;) # 极端化：9 种
display.brewer.all(type = &quot;qual&quot;) # 离散型：8 种</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="r"><code>xx &lt;- c(1912, 1912:1971, 1971)
yy &lt;- c(min(nhtemp), nhtemp, min(nhtemp))
plot(xx, yy, type = &quot;n&quot;, xlab = &quot;Year&quot;, ylab = &quot;Temperatures&quot;)#无图
for (i in seq(255, 0, -3)) {
  yy &lt;- c(45, nhtemp - (nhtemp - min(nhtemp)) * (1 - i / 255), 45) # rgb() 中的绿色成分逐渐变小
  polygon(xx, yy, col = rgb(1, i / 255, 0), border = NA)
  Sys.sleep(0.05)
  # 读者可以在这里加上 Sys.sleep(0.05) 以便看清作图过程
}
box() # 补齐边框</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-21-1.png" width="672" />
4. 颜色混合</p>
<pre class="r"><code>#out = alpha * new + (1 - alpha) * old
x &lt;- rgb(1, seq(0, 1, length = 30), 0)
barplot(rep(1, 30), col = x)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code># 三原色
x = rep(1,6)
names(x) = c(&quot;red&quot;,&quot;green&quot;,&quot;blue&quot;,&quot;magenta&quot;,&quot;yellow&quot;,&quot;cyan&quot;)
red = rgb(1,0,0,1)
green = rgb(0,1,0,1)
blue = rgb(0,0,1,1)
magenta = rgb(1,0,1,1)
yellow = rgb(1,1,0)
cyan = rgb(0,1,1)
barplot(x,col=c(red,green,blue,magenta,yellow,cyan) )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
</div>
<div id="section-9" class="section level2">
<h2>5.17</h2>
<pre class="r"><code>troops &lt;- read.table(system.file(&quot;extdata&quot;, &quot;troops.txt&quot;, package = &quot;MSG&quot;), header = TRUE)
cities &lt;- read.table(system.file(&quot;extdata&quot;, &quot;cities.txt&quot;, package = &quot;MSG&quot;), header = TRUE)
library(ggplot2)
p &lt;- ggplot(cities, aes(x = long, y = lat)) # 框架
p &lt;- p + geom_path(aes(size = survivors, colour = direction, group = group), 
                   data = troops, lineend = &quot;round&quot;) # 军队路线
p &lt;- p + geom_point() # 城市点
p &lt;- p + geom_text(aes(label = city), hjust = 0, vjust = 1, size = 2.5) # 城市名称
p &lt;- p + scale_colour_manual(values = c(&quot;grey50&quot;, &quot;red&quot;)) + 
  scale_size(range = c(1, 10)) +
  theme(legend.position = &quot;none&quot;) + 
  xlim(24, 39) # 细节调整工作
print(p) # 打印全图</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<ul>
<li>R 的编程方式是面向对象（Object-Oriented）的</li>
<li>向量：</li>
</ul>
<pre class="r"><code>1:10
c(7.11, 9.11, 9.19, 1.23)
x &lt;- c(7.11, 9.11, 9.19, 1.23)
x[c(1, 4)]
sort(x)
seq(7,9,0.2)
seq(7, 9, length.out = 6)#生成向量长度为 6
rep(1:3, 5)
rep(1:3, each = 5)</code></pre>
<ul>
<li>因子</li>
</ul>
<pre class="r"><code>x &lt;- factor(c(1, 2, 3, 1, 1, 3, 2, 3, 3), levels = 1:3, labels = c(&quot;g1&quot;, &quot;g2&quot;, &quot;g3&quot;))
#我们可以对因子型数据求频数、将其转化为整数或字符型向量。
table(x)
as.integer(x)
as.character(x)
#因子型数据在分类汇总时比较有用，例如在 tapply() 中：
y &lt;- 1:9
data.frame(y, x) # x 和 y 并列放的样子
tapply(y, x, mean) # x 的每一组的均值
#定序变量:与此相关的函数为 ordered()</code></pre>
<ul>
<li>数组和矩阵</li>
</ul>
<p>数组和矩阵可以分别由<code>array()</code>和<code>matrix()</code> 函数生成</p>
<pre class="r"><code>x &lt;- array(1:24, c(3, 4, 2)) # 3 维数组示例
dim(x)
x &lt;- matrix(1:12, nrow = 2, ncol = 6) # 矩阵示例
# 一个随机方阵
(x &lt;- matrix(c(2, 9, 4, 5, 6, 8, 1, 3, 7), 3))
solve(x)</code></pre>
<ul>
<li>数据框和列表</li>
</ul>
<p>数据框（data frame）和列表（list）是 R 中非常灵活的数据结构</p>
<pre class="r"><code># 生成一个数据框，前两列为数值型，后一列为字符型
data.frame(x = rnorm(5), y = runif(5), z = letters[1:5])
# 包含四个子对象的列表
Lst &lt;- list(name = &quot;Fred&quot;, wife = &quot;Mary&quot;, no.children = 3, child.ages = c(4, 7, 9))</code></pre>
<ul>
<li><p>矩阵的本质是（带有维度属性的）向量，数据框的本质是（整齐的）列表。</p></li>
<li><p>函数</p></li>
</ul>
<pre class="r"><code>kurtosis &lt;- function(x, na.rm = FALSE) {
  # 去掉缺失值
  if (na.rm) x &lt;- x[!is.na(x)]
  return(sum((x - mean(x))^4) / (length(x) * var(x)^2) - 3)
}#该函数有两个参数，数据向量x和是否删除缺失值 na.rm，后者有默认值 FALSE；
kurtosis(runif(100))
#泛型函数 （generic function）传给 plot() 的第一个参数是何种类，则调用何种函数进行作图
head(methods(&quot;plot&quot;), 24) # 显示前24个
class(iris)
plot(iris) # 调用 plot.data.frame() 作散点图矩阵</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre class="r"><code>x &lt;- density(faithful$waiting)
class(x)
par(mar = c(4, 4, 3, 0.5))
plot(x) # 调用 plot.density() 作密度曲线</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-28-2.png" width="672" /></p>
</div>
<div id="section-10" class="section level2">
<h2>5.16</h2>
<p>💞💞💞听大佬讲座！ <a href="https://connect.xjtlu.edu.cn/interaction/forum/topic.php?id=1132">大佬讲座ppt链接</a></p>
<pre><code>library(animation)
plot.new()
for (i in 1:30){
    points(runif(1), runif(1), pch = 19, cex = 2)
    Sys.sleep(0.2)
}</code></pre>
<pre class="r"><code>for (i in 1:20){
    hist(rnorm(20))
}</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-29-.gif" width="672" /></p>
</div>
<div id="section-11" class="section level2">
<h2>5.14</h2>
<p>吃的太饱容易犯困😵</p>
<ul>
<li>条形图</li>
</ul>
<pre class="r"><code># Load vcd package
library(vcd)
## Warning: 程辑包&#39;vcd&#39;是用R版本4.0.5 来建造的
## 载入需要的程辑包：grid
# Get cell counts for improved variable
counts &lt;- table(Arthritis$Improved)
counts
# simple bar plot
barplot(counts, main = &quot;Simple Bar Plot&quot;, xlab = &quot;Improvement&quot;, ylab = &quot;Frequency&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<pre class="r"><code>
# horizontal bar plot
barplot(counts, main = &quot;Horizontal Bar Plot&quot;, xlab = &quot;Frequency&quot;, ylab = &quot;Improvement&quot;, horiz = TRUE)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-30-2.png" width="672" /></p>
<pre class="r"><code># get counts for Improved by Treatment table
counts &lt;- table(Arthritis$Improved,Arthritis$Treatment)
counts
# stacked barplot
barplot(counts, main = &quot;Stacked Bar Plot&quot;, xlab = &quot;Treatment&quot;, ylab = &quot;Frequency&quot;, col = c(&quot;red&quot;, &quot;yellow&quot;, &quot;green&quot;), legend = rownames(counts))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-30-3.png" width="672" /></p>
<pre class="r"><code>
# grouped barplot
barplot(counts, main = &quot;Grouped Bar Plot&quot;, xlab = &quot;Treatment&quot;, ylab = &quot;Frequency&quot;, col = c(&quot;red&quot;, &quot;yellow&quot;, &quot;green&quot;), legend = rownames(counts), beside = TRUE)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-30-4.png" width="672" /></p>
<pre class="r"><code># Mean bar plots
states &lt;- data.frame(state.region, state.x77)
means &lt;- aggregate(states$Illiteracy, 
    by = list(state.region), 
    FUN = mean)
means
means &lt;- means[order(means$x), ]
means
barplot(means$x, names.arg = means$Group.1)
title(&quot;Mean Illiteracy Rate&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-30-5.png" width="672" /></p>
<pre class="r"><code>#为棘状图（spinogram）
attach(Arthritis) 
counts &lt;- table(Treatment, Improved) 
spine(counts, main=&quot;Spinogram Example&quot;) </code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-30-6.png" width="672" /></p>
<pre class="r"><code>detach(Arthritis) </code></pre>
</div>
<div id="section-12" class="section level2">
<h2>5.13</h2>
<p>睡得好是真的很重要呀</p>
<pre class="r"><code>options(digits=2)#)限定了输出小数点后数字位数
Student &lt;- c(&quot;John Davis&quot;, &quot;Angela Williams&quot;, 
    &quot;Bullwinkle Moose&quot;, &quot;David Jones&quot;, 
    &quot;Janice Markhammer&quot;, &quot;Cheryl Cushing&quot;,
    &quot;Reuven Ytzrhak&quot;, &quot;Greg Knox&quot;, &quot;Joel England&quot;,
    &quot;Mary Rayburn&quot;)
Math &lt;- c(502, 600, 412, 358, 495, 512, 410, 625, 573, 522)
Science &lt;- c(95, 99, 80, 82, 75, 85, 80, 95, 89, 86)
English &lt;- c(25, 22, 18, 15, 20, 28, 15, 30, 27, 18)
roster &lt;- data.frame(Student, Math, Science, English,stringsAsFactors=FALSE)
    
z &lt;- scale(roster[,2:4]) #将变量进行标准化

score &lt;- apply(z, 1, mean)                     
roster &lt;- cbind(roster, score)
#通过函数mean()来计算各行的均值以获得综合得分，并使用函数cbind()将其添加到花名册中 
y &lt;- quantile(score, c(.8,.6,.4,.2)) #函数quantile()给出了学生综合得分的百分位数                                  
roster$grade[score &gt;= y[1]] &lt;- &quot;A&quot;           
roster$grade[score &lt; y[1] &amp; score &gt;= y[2]] &lt;- &quot;B&quot;
roster$grade[score &lt; y[2] &amp; score &gt;= y[3]] &lt;- &quot;C&quot;
roster$grade[score &lt; y[3] &amp; score &gt;= y[4]] &lt;- &quot;D&quot;
roster$grade[score &lt; y[4]] &lt;- &quot;F&quot;

name &lt;- strsplit((roster$Student), &quot; &quot;) #使用函数strsplit()以空格为界把学生姓名拆分为姓氏和名字           
#你可以使用函数sapply()提取列表中每个成分的第一个元素，放入一个储存名字的向量Firstname，并提取每个成分的第二个元素，放入一个储存姓氏的向量Lastname。&quot;[&quot;是一个可以提取某个对象的一部分的函数——在这里它是用来提取列表name各成分中的第一个或第二个元素的。
lastname &lt;- sapply(name, &quot;[&quot;, 2)
firstname &lt;- sapply(name, &quot;[&quot;, 1)

roster &lt;- cbind(firstname,lastname, roster[,-1])
roster &lt;- roster[order(lastname,firstname),]

roster</code></pre>
<pre class="r"><code># for
for (i in 1:10) 
    print(i)
# while
i &lt;- 10 
while (i &gt; 0) {
    print(i)
    i &lt;- i - 1} </code></pre>
<ul>
<li><p>if</p>
<ul>
<li><code>if (cond) statement1 else statement2</code></li>
<li><code>ifelse(cond, statement1, statement2)</code></li>
</ul></li>
<li><p>switch <code>switch(expr, ...)</code></p></li>
</ul>
<pre class="r"><code>mydate &lt;- function(type=&quot;long&quot;) {
    switch(type,
    long =  format(Sys.time(), &quot;%A %B %d %Y&quot;), 
    short = format(Sys.time(), &quot;%m-%d-%y&quot;),
    cat(type, &quot;is not a recognized type\n&quot;))
}
mydate(&quot;long&quot;)
mydate(&quot;short&quot;)
mydate()
mydate(&quot;medium&quot;)</code></pre>
<ul>
<li>函数</li>
</ul>
<!-- -->
<pre><code>myfunction &lt;- function(arg1, arg2, ... ){ 
 statements 
 return(object) 
} </code></pre>
<p><img src="5.jpg" /></p>
<ul>
<li>包reshape2 <code>数melt()和dcast()</code></li>
</ul>
</div>
<div id="section-13" class="section level2">
<h2>5.12</h2>
<p>昨晚是被蚊子毁掉的睡眠！</p>
<pre class="r"><code>x &lt;- c(1, 2, 3, 4, 5, 6, 7, 8)
mean(x)
sd(x)</code></pre>
<p><img src="2.jpg" /></p>
<pre class="r"><code># normal distribution
library(MASS)
## Warning: 程辑包&#39;MASS&#39;是用R版本4.0.5 来建造的
options(digits=3)
set.seed(1234)
mean &lt;- c(230.7, 146.7, 3.6)           
sigma &lt;- matrix( c(15360.8, 6721.2, -47.1,                           6721.2, 4700.9, -16.5,
            -47.1,  -16.5,   0.3), nrow=3, ncol=3)
mydata &lt;- mvrnorm(500, mean, sigma)             
mydata &lt;- as.data.frame(mydata)                   
names(mydata) &lt;- c(&quot;y&quot;, &quot;x1&quot;, &quot;x2&quot;)               
dim(mydata)
head(mydata, n=10)   </code></pre>
<ul>
<li>字符串处理函数</li>
<li>其他有用函数 <img src="4.jpg" /></li>
<li>R中提供了一个<code>apply()</code>函数，可将一个任意函数“应用”到矩阵、数组、数据框的任何维 度上。<code>apply()</code>函数的使用格式为： <code>apply(x, MARGIN, FUN, ...)</code></li>
</ul>
</div>
<div id="section-14" class="section level2">
<h2>5.11</h2>
<p>答辩让我好疲惫。。</p>
<ul>
<li>日期</li>
</ul>
<pre class="r"><code>mydates &lt;- as.Date(c(&quot;2007-06-22&quot;,&quot;2004-02-13&quot;)) 
today &lt;- Sys.Date() 
format(today, format=&quot;%B %d %Y&quot;) 
dob &lt;- as.Date(&quot;2000-01-02&quot;)
difftime(today, dob, units=&quot;weeks&quot;) 
#strDates &lt;- as.character(dates)将日期转为字符</code></pre>
<p><img src="1.jpg" /></p>
<pre class="r"><code>a &lt;- c(1, 2, 3)
a
is.numeric(a)
is.vector(a)
a &lt;- as.character(a)
a
is.numeric(a)
is.vector(a)
is.character(a)</code></pre>
<ul>
<li>使用<code>order()</code>函数对一个数据框进行排序。默认的排序顺序是升序。在排序变量的前边加一个减号即可得到降序的排序结果</li>
<li>横向合并两个数据框（数据集），使用<code>merge()</code>函数，<code>rbind(),cbind()</code></li>
<li><code>subset()</code>函数大概是选择变量和观测最简单的方法</li>
<li><code>sample()</code>函数能够让你从数据集中（有放回或无放回地）抽取大小为n的一个随机样本</li>
</ul>
<pre class="r"><code>library(sqldf)
## Warning: 程辑包&#39;sqldf&#39;是用R版本4.0.5 来建造的
## 载入需要的程辑包：gsubfn
## Warning: 程辑包&#39;gsubfn&#39;是用R版本4.0.5 来建造的
## 载入需要的程辑包：proto
## Warning: 程辑包&#39;proto&#39;是用R版本4.0.5 来建造的
## 载入需要的程辑包：RSQLite
newdf &lt;- sqldf(&quot;select * from mtcars where carb=1 order by mpg&quot;, 
    row.names = TRUE)
newdf &lt;- sqldf(&quot;select avg(mpg) as avg_mpg, avg(disp) as avg_disp,
    gear from mtcars where cyl in (4, 6) group by gear&quot;)</code></pre>
</div>
<div id="section-15" class="section level2">
<h2>5.10</h2>
<pre class="r"><code>mydata &lt;- data.frame(x1 = c(2, 2, 6, 4), x2 = c(3, 4, 2, 8))
mydata$sumx &lt;- mydata$x1 + mydata$x2
mydata$meanx &lt;- (mydata$x1 + mydata$x2)/2
attach(mydata)
mydata$sumx &lt;- x1 + x2
mydata$meanx &lt;- (x1 + x2)/2
detach(mydata)
mydata &lt;- transform(mydata, sumx = x1 + x2, meanx = (x1 + x2)/2)</code></pre>
<ul>
<li>plyr包中有一个<code>rename()</code>函数，可用于修改变量名</li>
</ul>
<pre class="r"><code>y &lt;- c(1, 2, 3, NA) 
print(is.na(y))
x &lt;- c(1, 2, NA, 3) 
print(sum(x, na.rm=TRUE))</code></pre>
<ul>
<li><code>na.omit()</code>可以删除所有含有缺失数据的行</li>
</ul>
</div>
<div id="section-16" class="section level2">
<h2>5.9</h2>
<pre class="r"><code>attach(mtcars)
## The following object is masked from package:ggplot2:
## 
##     mpg
plot(wt, mpg)
abline(lm(mpg ~ wt))
title(&quot;Regression of MPG on Weight&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<pre class="r"><code>detach(mtcars)</code></pre>
<ul>
<li>可用<code>par(optionname=value,optionname=name,...)</code>修改图形参数，也可用高级绘图函数直接提供的optionname=value的键值对</li>
<li>函数<code>colors()</code>可以返回所有可用颜色的名称</li>
<li>函数<code>plotmath()</code>可以为图形主体或边界上的标题、坐标轴名称或文本标注添加数学符号</li>
<li><code>layout()</code>👍</li>
</ul>
</div>
<div id="section-17" class="section level2">
<h2>5.8</h2>
<pre class="r"><code>#矩阵
y = matrix(1:20,nrow = 5, ncol = 4)
y
cells &lt;- c(1, 26, 24, 68)
rnames &lt;- c(&quot;R1&quot;, &quot;R2&quot;)
cnames &lt;- c(&quot;C1&quot;, &quot;C2&quot;)
mymatrix &lt;- matrix(cells, nrow = 2, ncol = 2, byrow = TRUE, 
    dimnames = list(rnames, cnames))
mymatrix
mymatrix &lt;- matrix(cells, nrow = 2, ncol = 2, byrow = FALSE, 
    dimnames = list(rnames, cnames))
mymatrix
#数组：个创建三维（2×3×4）数值型数组
dim1 &lt;- c(&quot;A1&quot;, &quot;A2&quot;)
dim2 &lt;- c(&quot;B1&quot;, &quot;B2&quot;, &quot;B3&quot;)
dim3 &lt;- c(&quot;C1&quot;, &quot;C2&quot;, &quot;C3&quot;, &quot;C4&quot;)
z &lt;- array(1:24, c(2, 3, 4), dimnames = list(dim1, dim2, dim3))
z</code></pre>
<pre class="r"><code>#创建数据框
patientID &lt;- c(1, 2, 3, 4)
age &lt;- c(25, 34, 28, 52)
diabetes &lt;- c(&quot;Type1&quot;, &quot;Type2&quot;, &quot;Type1&quot;, &quot;Type1&quot;)
status &lt;- c(&quot;Poor&quot;, &quot;Improved&quot;, &quot;Excellent&quot;, &quot;Poor&quot;)
patientdata &lt;- data.frame(patientID, age, diabetes, 
    status)
patientdata
patientdata$age
table(patientdata$diabetes, patientdata$status)#生成糖尿病类型变量diabetes和病情变量status的列联表</code></pre>
<ul>
<li>函数attach()可将数据框添加到R的搜索路径中。R在遇到一个变量名以后，将检查搜索路径中的数据框，但是<a href="https://google.github.io/styleguide/Rguide.html">R代码风格说明</a>里说最好不要用噢哈哈哈</li>
<li><strong>with</strong></li>
<li>类别（名义型）变量和有序类别（有序型）变量在R中称为因子（factor）</li>
</ul>
<pre class="r"><code>patientID &lt;- c(1, 2, 3, 4)
age &lt;- c(25, 34, 28, 52)
diabetes &lt;- c(&quot;Type1&quot;, &quot;Type2&quot;, &quot;Type1&quot;, &quot;Type1&quot;)
status &lt;- c(&quot;Poor&quot;, &quot;Improved&quot;, &quot;Excellent&quot;, &quot;Poor&quot;)
diabetes &lt;- factor(diabetes)
status &lt;- factor(status, order = TRUE)
patientdata &lt;- data.frame(patientID, age, diabetes, status)
str(patientdata)</code></pre>
<ul>
<li>edit() 可以修改数据</li>
</ul>
</div>
<div id="section-18" class="section level2">
<h2>5.7</h2>
<pre class="r"><code>help.start()
## starting httpd help server ... done
help(package = &quot;vcd&quot;)
library(vcd) 
help(Arthritis) #阅读数据集Arthritis的描述
Arthritis 
example(Arthritis)# 运行数据集Arthritis自带的示例</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-45-1.png" width="672" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-45-2.png" width="672" /></p>
<pre class="r"><code>#q()</code></pre>
</div>
